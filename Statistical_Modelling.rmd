---
title: "Modelling Temperature by Elevation From Different Resolution DEM's"
author: "Dana Melamed & Perry Comolli"
date: "March 19, 2018"
output: html_document
---
```{r}
library(readr)
library(modelr)
library(lubridate)
library(dplyr)
library(reshape2)
library(mgcv)
```


We know that elevation and temperature are related, but...
While temperature is captured at a point location, elevation is often taken from a raster of elevations, called a digital elevation model (DEM). The spatial resolution of the DEM determines the elevation at the cell overlapping with a weather station point. 

I have a table of daily temperatures (min, max and mean) recorded at weather stations, and the corresponding elevation at different resolution dems. (Scroll over)

```{r}
df <- read_rds("C:\\MScAG\\AcadiaBioMII_Melamed_Comolli\\elevation_test.rds")
head(df)
```



For modelling, I am going to melt the table so that elevation is a single column, and another column describes which resolution DEM the elevation is from. The melted columns need to be renamed from the defaults.

```{r}
df_start <- melt(df, id = c("stationid","EASTING","NORTHING","date_time",
                                "temp_mean","temp_max","temp_min"))
#rename columns
df_start <- df_start %>%
  dplyr::rename(elev = value, dem = variable) %>%
  mutate(date_time = as.Date(date_time, format = "%Y-%m-%d"))
head(df)
```

The table includes every day from 2011 - 2017. For now, that will be reduced to just a single week. Lets choose a week in August

```{r}
df <- df_start %>%
  filter(year(date_time) %in% c(2012,2013,2014,2015))
         

# look at a range of dates
```





Now, a model can be made ...elevation is multipled by the type of DEM
```{r}
m1 <- gam(temp_max ~ s(EASTING,NORTHING, k = 10) +
                     s(elev, week(date_time))             +
                     s(yday(date_time), k = 6) +
                     as.numeric(year(date_time)) +
                     dem
          , data = df)

par(mfrow = c(2,2))
plot(m1)
```

And the summary...
```{r}
summary(m1)
```

```

